layui.define("layer",function(q){var k=layui.$,y=layui.layer,h=layui.hint(),w=layui.device(),g={config:{},set:function(c){var a=this;return a.config=k.extend({},a.config,c),a},on:function(c,a){return layui.onevent.call(this,b,c,a)}},j=function(){var a=this;return{upload:function(c){a.upload.call(a,c)},config:a.config}},b="upload",x="layui-upload-file",v="layui-upload-form",m="layui-upload-iframe",z="layui-upload-choose",d=function(c){var a=this;a.config=k.extend({},a.config,g.config,c),a.render()};d.prototype.config={accept:"images",exts:"",auto:!0,bindAction:"",url:"",field:"file",method:"post",data:{},drag:!0,size:0,number:0,multiple:!1},d.prototype.render=function(c){var a=this,c=a.config;c.elem=k(c.elem),c.bindAction=k(c.bindAction),a.file(),a.events()},d.prototype.file=function(){var c=this,a=c.config,i=c.elemFile=k(['<input class="'+x+'" type="file" accept="'+a.acceptMime+'" name="'+a.field+'"',a.multiple?" multiple":"",">"].join("")),f=a.elem.next();(f.hasClass(x)||f.hasClass(v))&&f.remove(),w.ie&&w.ie<10&&a.elem.wrap('<div class="layui-upload-wrap"></div>'),c.isFile()?(c.elemFile=a.elem,a.field=a.elem[0].name):a.elem.after(i),w.ie&&w.ie<10&&c.initIE()},d.prototype.initIE=function(){var i=this,f=i.config,l=k('<iframe id="'+m+'" class="'+m+'" name="'+m+'" frameborder="0"></iframe>'),c=k(['<form target="'+m+'" class="'+v+'" method="'+f.method,'" key="set-mine" enctype="multipart/form-data" action="'+f.url+'">',"</form>"].join(""));k("#"+m)[0]||k("body").append(l),f.elem.next().hasClass(v)||(i.elemFile.wrap(c),f.elem.next("."+v).append(function(){var a=[];return layui.each(f.data,function(n,e){e="function"==typeof e?e():e,a.push('<input type="hidden" name="'+n+'" value="'+e+'">')}),a.join("")}()))},d.prototype.msg=function(a){return y.msg(a,{icon:2,shift:6})},d.prototype.isFile=function(){var a=this.config.elem[0];if(a){return"input"===a.tagName.toLocaleLowerCase()&&"file"===a.type}},d.prototype.preview=function(c){var a=this;window.FileReader&&layui.each(a.chooseFiles,function(f,e){var l=new FileReader;l.readAsDataURL(e),l.onload=function(){c&&c(f,e,this.result)}})},d.prototype.upload=function(C,K){var i,f=this,s=f.config,a=f.elemFile[0],I=function(){var l=0,o=0,c=C||f.files||f.chooseFiles||a.files,e=function(){s.multiple&&l+o===f.fileLength&&"function"==typeof s.allDone&&s.allDone({total:f.fileLength,successful:l,aborted:o})};layui.each(c,function(u,n){var t=new FormData;t.append(s.field,n),layui.each(s.data,function(F,r){r="function"==typeof r?r():r,t.append(F,r)}),k.ajax({url:s.url,type:s.method,data:t,contentType:!1,processData:!1,dataType:"json",headers:s.headers||{},success:function(r){l++,D(u,r),e()},error:function(){o++,f.msg("请求上传接口出现异常"),p(u),e()}})})},E=function(){var c=k("#"+m);f.elemFile.parent().submit(),clearInterval(d.timer),d.timer=setInterval(function(){var l,e=c.contents().find("body");try{l=e.text()}catch(o){f.msg("获取上传后的响应信息出现异常"),clearInterval(d.timer),p()}l&&(clearInterval(d.timer),e.html(""),D(0,l))},30)},D=function(n,l){if(f.elemFile.next("."+z).remove(),a.value="","object"!=typeof l){try{l=JSON.parse(l)}catch(c){return l={},f.msg("请对上传接口返回有效JSON")}}"function"==typeof s.done&&s.done(l,n||0,function(o){f.upload(o)})},p=function(c){s.auto&&(a.value=""),"function"==typeof s.error&&s.error(c||0,function(l){f.upload(l)})},A=s.exts,H=function(){var c=[];return layui.each(C||f.chooseFiles,function(n,l){c.push(l.name)}),c}(),B={preview:function(c){f.preview(c)},upload:function(n,l){var c={};c[n]=l,f.upload(c)},pushFile:function(){return f.files=f.files||{},layui.each(f.chooseFiles,function(l,c){f.files[l]=c}),f.files},resetFile:function(o,l,c){var r=new File([l],c);f.files=f.files||{},f.files[o]=r}},G=function(){if("choose"!==K&&!s.auto||(s.choose&&s.choose(B),"choose"!==K)){return s.before&&s.before(B),w.ie?w.ie>9?I():E():void I()}};if(H=0===H.length?a.value.match(/[^\/\\]+\..+/g)||[]||"":H,0!==H.length){switch(s.accept){case"file":if(A&&!RegExp("\\w\\.("+A+")$","i").test(escape(H))){return f.msg("选择的文件中包含不支持的格式"),a.value=""}break;case"video":if(!RegExp("\\w\\.("+(A||"avi|mp4|wma|rmvb|rm|flash|3gp|flv")+")$","i").test(escape(H))){return f.msg("选择的视频中包含不支持的格式"),a.value=""}break;case"audio":if(!RegExp("\\w\\.("+(A||"mp3|wav|mid")+")$","i").test(escape(H))){return f.msg("选择的音频中包含不支持的格式"),a.value=""}break;default:if(layui.each(H,function(l,c){RegExp("\\w\\.("+(A||"jpg|png|gif|bmp|jpeg$")+")","i").test(escape(c))||(i=!0)}),i){return f.msg("选择的图片中包含不支持的格式"),a.value=""}}if(f.fileLength=function(){var e=0,c=C||f.files||f.chooseFiles||a.files;return layui.each(c,function(){e++}),e}(),s.number&&f.fileLength>s.number){return f.msg("同时最多只能上传的数量为："+s.number)}if(s.size>0&&!(w.ie&&w.ie<10)){var J;if(layui.each(f.chooseFiles,function(n,l){if(l.size>1024*s.size){var c=s.size/1024;c=c>=1?c.toFixed(2)+"MB":s.size+"KB",a.value="",J=c}}),J){return f.msg("文件不能超过"+J)}}G()}},d.prototype.events=function(){var f=this,c=f.config,i=function(e){f.chooseFiles={},layui.each(e,function(o,l){var p=(new Date).getTime();f.chooseFiles[p+"-"+o]=l})},a=function(l,r){var e=f.elemFile,p=l.length>1?l.length+"个文件":(l[0]||{}).name||e[0].value.match(/[^\/\\]+\..+/g)||[]||"";e.next().hasClass(z)&&e.next().remove(),f.upload(null,"choose"),f.isFile()||c.choose||e.after('<span class="layui-inline '+z+'">'+p+"</span>")};c.elem.off("upload.start").on("upload.start",function(){var n=k(this),p=n.attr("lay-data");if(p){try{p=new Function("return "+p)(),f.config=k.extend({},c,p)}catch(e){h.error("Upload element property lay-data configuration item has a syntax error: "+p)}}f.config.item=n,f.elemFile[0].click()}),w.ie&&w.ie<10||c.elem.off("upload.over").on("upload.over",function(){var l=k(this);l.attr("lay-over","")}).off("upload.leave").on("upload.leave",function(){var l=k(this);l.removeAttr("lay-over")}).off("upload.drop").on("upload.drop",function(p,e){var o=k(this),l=e.originalEvent.dataTransfer.files||[];o.removeAttr("lay-over"),i(l),c.auto?f.upload(l):a(l)}),f.elemFile.off("upload.change").on("upload.change",function(){var e=this.files||[];i(e),c.auto?f.upload():a(e)}),c.bindAction.off("upload.action").on("upload.action",function(){f.upload()}),c.elem.data("haveEvents")||(f.elemFile.on("change",function(){k(this).trigger("upload.change")}),c.elem.on("click",function(){f.isFile()||k(this).trigger("upload.start")}),c.drag&&c.elem.on("dragover",function(l){l.preventDefault(),k(this).trigger("upload.over")}).on("dragleave",function(l){k(this).trigger("upload.leave")}).on("drop",function(l){l.preventDefault(),k(this).trigger("upload.drop",l)}),c.bindAction.on("click",function(){k(this).trigger("upload.action")}),c.elem.data("haveEvents",!0))},g.render=function(c){var a=new d(c);return j.call(a)},q(b,g)});